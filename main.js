/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/
var v=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var A=(u,t)=>{for(var e in t)v(u,e,{get:t[e],enumerable:!0})},M=(u,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of S(t))!k.call(u,n)&&n!==e&&v(u,n,{get:()=>t[n],enumerable:!(i=D(t,n))||i.enumerable});return u};var $=u=>M(v({},"__esModule",{value:!0}),u);var C={};A(C,{default:()=>w});module.exports=$(C);var r=require("obsidian");var m=require("obsidian"),y={noteTitle:"Table of content",maxHeadingDepth:3,excludePatterns:"",showPrimaryFolderName:!0,sortMode:"mixed"},F=class extends m.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new m.Setting(t).setName("Titre de la note TOC").setDesc("Nom du fichier et titre affich\xE9 pour la table des mati\xE8res.").addText(e=>e.setPlaceholder("Table of content").setValue(this.plugin.settings.noteTitle).onChange(async i=>{this.plugin.settings.noteTitle=i||y.noteTitle,await this.plugin.saveSettings()})),new m.Setting(t).setName("Maximum heading depth").setDesc("Highest heading level (Hx) to include under each note. Default H3.").addSlider(e=>e.setLimits(1,6,1).setValue(this.plugin.settings.maxHeadingDepth).setDynamicTooltip().onChange(async i=>{this.plugin.settings.maxHeadingDepth=i,await this.plugin.saveSettings()})),new m.Setting(t).setName("Exclude patterns").setDesc("Comma-separated substrings to skip (matched against full paths). Example: img,assets").addText(e=>e.setPlaceholder("img,assets").setValue(this.plugin.settings.excludePatterns).onChange(async i=>{this.plugin.settings.excludePatterns=i,await this.plugin.saveSettings()})),new m.Setting(t).setName("Afficher le dossier primaire").setDesc("Pr\xE9fixe chaque note par le dossier principal: <dossier> -> <note>.").addToggle(e=>e.setValue(this.plugin.settings.showPrimaryFolderName).onChange(async i=>{this.plugin.settings.showPrimaryFolderName=i,await this.plugin.saveSettings()})),new m.Setting(t).setName("Ordre de tri").setDesc("Choisir le tri des notes: num\xE9rique, alphab\xE9tique ou mixte (lettres d'abord, puis chiffres).").addDropdown(e=>e.addOption("numeric","Num\xE9rique").addOption("alphabetic","Alphab\xE9tique").addOption("mixed","Mixte").setValue(this.plugin.settings.sortMode).onChange(async i=>{this.plugin.settings.sortMode=i,await this.plugin.saveSettings()}))}};var N="Table of content",w=class extends r.Plugin{async onload(){await this.loadSettings(),this.registerFileMenuItem(),this.addSettingTab(new F(this.app,this)),this.addCommand({id:"toc-maker",name:"Generate TOC for active file's folder",callback:async()=>{let t=this.app.workspace.getActiveFile();if(!t){new r.Notice("No active file found.");return}let e=t.parent;if(!e||!(e instanceof r.TFolder)){new r.Notice("Active file has no parent folder.");return}await this.generateToc(e)}})}onunload(){}registerFileMenuItem(){this.registerEvent(this.app.workspace.on("file-menu",(t,e)=>{e instanceof r.TFolder&&t.addItem(i=>i.setTitle("Generate TOC").setIcon("list").onClick(async()=>{await this.generateToc(e)}))}))}async generateToc(t){let e=this.getTocTitle(),i=this.buildTocPath(t,e),n=this.collectMarkdownFiles(t,i);if(!n.length){new r.Notice("No markdown files found in folder.");return}let a=this.sortFiles(t,n),s=[`# ${e}`,""];for(let c of a){let x=this.formatNoteDisplay(t,c);s.push(`- [[${this.toLinkPath(c)}|${x}]]`);let h=await this.extractHeadings(c);for(let l of h){let o="	".repeat(Math.max(1,l.level)),d=`${this.toLinkPath(c)}#${l.text}`;s.push(`${o}- [[${d}|${l.text}]]`)}}let p=s.join(`
`),g=this.app.vault.getAbstractFileByPath(i);if(g&&!(g instanceof r.TFile)){new r.Notice("A folder or non-markdown item blocks the TOC path.");return}try{g instanceof r.TFile?await this.app.vault.modify(g,p):await this.app.vault.create(i,p),new r.Notice("Table of content updated.")}catch(c){console.error(c),new r.Notice("Failed to write Table of content note.")}}collectMarkdownFiles(t,e){let i=t.path?`${t.path}/`:"",n=this.parseExcludePatterns();return this.app.vault.getMarkdownFiles().filter(a=>a.path.startsWith(i)).filter(a=>a.path!==e).filter(a=>!this.matchesExclude(a.path,n))}sortFiles(t,e){var x;let i=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"}),n=(x=this.settings.sortMode)!=null?x:"mixed",a=new Map,s=h=>{let l=a.get(h.path);if(l!==void 0)return l;let o=this.getNoteTitle(h).trim();return a.set(h.path,o),o},p=(h,l)=>{let o=s(h),d=s(l);return i.compare(o,d)},g=(h,l)=>{let o=s(h),d=s(l),T=this.extractLeadingNumber(o),f=this.extractLeadingNumber(d);return T!==null&&f!==null?T!==f?T-f:i.compare(o,d):T!==null?-1:f!==null?1:i.compare(o,d)},c=(h,l)=>{let o=s(h),d=s(l),T=/^[A-Za-z]/.test(o),f=/^[A-Za-z]/.test(d);if(T!==f)return T?-1:1;let b=/^\d/.test(o),P=/^\d/.test(d);return b!==P?b?-1:1:i.compare(o,d)};switch(n){case"numeric":return[...e].sort(g);case"alphabetic":return[...e].sort(p);default:return[...e].sort(c)}}extractLeadingNumber(t){let e=t.match(/^\s*(\d+)/);if(!e)return null;let i=e[1];return i?Number.parseInt(i,10):null}async extractHeadings(t){let e=await this.app.vault.cachedRead(t),i=/^(#{1,6})\s+(.+)$/gm,n=[],a=this.clampHeadingDepth(this.settings.maxHeadingDepth),s;for(;(s=i.exec(e))!==null;){let p=s[1],g=s[2];if(!p||!g)continue;let c=p.length;c>a||n.push({level:c,text:g.trim()})}return n}clampHeadingDepth(t){return Number.isNaN(t)?3:Math.min(Math.max(t,1),6)}formatNoteDisplay(t,e){let i=this.getNoteTitle(e);if(!this.settings.showPrimaryFolderName)return i;let n=this.getPrimaryFolderName(t,e);return n?`${n} -> ${i}`:i}getNoteTitle(t){return t.name.replace(/\.md$/i,"")}getPrimaryFolderName(t,e){var s,p;let i=t.path?`${t.path}/`:"",a=(e.path.startsWith(i)?e.path.slice(i.length):e.path).split("/");return a.length>1?(s=a[a.length-2])!=null?s:"":(p=t.name)!=null?p:""}toLinkPath(t){return t.path.replace(/\.md$/i,"")}buildTocPath(t,e){let i=this.toSafeFileName(`${e}.md`);return t.path?`${t.path}/${i}`:i}getTocTitle(){return(this.settings.noteTitle||"").trim()||N}parseExcludePatterns(){return this.settings.excludePatterns.split(",").map(t=>t.trim()).filter(Boolean)}toSafeFileName(t){return t.replace(/[\\/:*?"<>|]/g,"-").trim()||`${N}.md`}matchesExclude(t,e){let i=t.toLowerCase();return e.some(n=>i.includes(n.toLowerCase()))}async loadSettings(){this.settings=Object.assign({},y,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
