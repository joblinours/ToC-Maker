/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/
var m=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var b=(l,t)=>{for(var e in t)m(l,e,{get:t[e],enumerable:!0})},N=(l,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of P(t))!y.call(l,a)&&a!==e&&m(l,a,{get:()=>t[a],enumerable:!(i=v(t,a))||i.enumerable});return l};var S=l=>N(m({},"__esModule",{value:!0}),l);var D={};b(D,{default:()=>d});module.exports=S(D);var n=require("obsidian");var h=require("obsidian"),T={noteTitle:"Table of content",maxHeadingDepth:3,excludePatterns:"",showPrimaryFolderName:!0},p=class extends h.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new h.Setting(t).setName("Titre de la note TOC").setDesc("Nom du fichier et titre affich\xE9 pour la table des mati\xE8res.").addText(e=>e.setPlaceholder("Table of content").setValue(this.plugin.settings.noteTitle).onChange(async i=>{this.plugin.settings.noteTitle=i||T.noteTitle,await this.plugin.saveSettings()})),new h.Setting(t).setName("Maximum heading depth").setDesc("Highest heading level (Hx) to include under each note. Default H3.").addSlider(e=>e.setLimits(1,6,1).setValue(this.plugin.settings.maxHeadingDepth).setDynamicTooltip().onChange(async i=>{this.plugin.settings.maxHeadingDepth=i,await this.plugin.saveSettings()})),new h.Setting(t).setName("Exclude patterns").setDesc("Comma-separated substrings to skip (matched against full paths). Example: img,assets").addText(e=>e.setPlaceholder("img,assets").setValue(this.plugin.settings.excludePatterns).onChange(async i=>{this.plugin.settings.excludePatterns=i,await this.plugin.saveSettings()})),new h.Setting(t).setName("Afficher le dossier primaire").setDesc("Pr\xE9fixe chaque note par le dossier principal: <dossier> -> <note>.").addToggle(e=>e.setValue(this.plugin.settings.showPrimaryFolderName).onChange(async i=>{this.plugin.settings.showPrimaryFolderName=i,await this.plugin.saveSettings()}))}};var f="Table of content",d=class extends n.Plugin{async onload(){await this.loadSettings(),this.registerFileMenuItem(),this.addSettingTab(new p(this.app,this)),this.addCommand({id:"generate-toc-active-folder",name:"Generate TOC for active file's folder",callback:async()=>{let t=this.app.workspace.getActiveFile();if(!t){new n.Notice("No active file found.");return}let e=t.parent;if(!e||!(e instanceof n.TFolder)){new n.Notice("Active file has no parent folder.");return}await this.generateToc(e)}})}onunload(){}registerFileMenuItem(){this.registerEvent(this.app.workspace.on("file-menu",(t,e)=>{e instanceof n.TFolder&&t.addItem(i=>i.setTitle("Generate TOC").setIcon("list").onClick(async()=>{await this.generateToc(e)}))}))}async generateToc(t){let e=this.getTocTitle(),i=this.buildTocPath(t,e),a=this.collectMarkdownFiles(t,i);if(!a.length){new n.Notice("No markdown files found in folder.");return}let s=[`# ${e}`,""];for(let c of a){let g=this.formatNoteDisplay(t,c);s.push(`- [[${this.toLinkPath(c)}|${g}]]`);let x=await this.extractHeadings(c);for(let u of x){let F="	".repeat(Math.max(1,u.level)),w=`${this.toLinkPath(c)}#${u.text}`;s.push(`${F}- [[${w}|${u.text}]]`)}}let r=s.join(`
`),o=this.app.vault.getAbstractFileByPath(i);if(o&&!(o instanceof n.TFile)){new n.Notice("A folder or non-markdown item blocks the TOC path.");return}try{o instanceof n.TFile?await this.app.vault.modify(o,r):await this.app.vault.create(i,r),new n.Notice("Table of content updated.")}catch(c){console.error(c),new n.Notice("Failed to write Table of content note.")}}collectMarkdownFiles(t,e){let i=t.path?`${t.path}/`:"",a=this.parseExcludePatterns();return this.app.vault.getMarkdownFiles().filter(s=>s.path.startsWith(i)).filter(s=>s.path!==e).filter(s=>!this.matchesExclude(s.path,a)).sort((s,r)=>s.path.localeCompare(r.path))}async extractHeadings(t){let e=await this.app.vault.cachedRead(t),i=/^(#{1,6})\s+(.+)$/gm,a=[],s=this.clampHeadingDepth(this.settings.maxHeadingDepth),r;for(;(r=i.exec(e))!==null;){let o=r[1],c=r[2];if(!o||!c)continue;let g=o.length;g>s||a.push({level:g,text:c.trim()})}return a}clampHeadingDepth(t){return Number.isNaN(t)?3:Math.min(Math.max(t,1),6)}formatNoteDisplay(t,e){let i=this.getNoteTitle(e);if(!this.settings.showPrimaryFolderName)return i;let a=this.getPrimaryFolderName(t,e);return a?`${a} -> ${i}`:i}getNoteTitle(t){return t.name.replace(/\.md$/i,"")}getPrimaryFolderName(t,e){var r,o;let i=t.path?`${t.path}/`:"",s=(e.path.startsWith(i)?e.path.slice(i.length):e.path).split("/");return s.length>1?(r=s[s.length-2])!=null?r:"":(o=t.name)!=null?o:""}toLinkPath(t){return t.path.replace(/\.md$/i,"")}buildTocPath(t,e){let i=this.toSafeFileName(`${e}.md`);return t.path?`${t.path}/${i}`:i}getTocTitle(){return(this.settings.noteTitle||"").trim()||f}parseExcludePatterns(){return this.settings.excludePatterns.split(",").map(t=>t.trim()).filter(Boolean)}toSafeFileName(t){return t.replace(/[\\/:*?"<>|]/g,"-").trim()||`${f}.md`}matchesExclude(t,e){let i=t.toLowerCase();return e.some(a=>i.includes(a.toLowerCase()))}async loadSettings(){this.settings=Object.assign({},T,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
